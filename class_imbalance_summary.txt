╔════════════════════════════════════════════════════════════════╗
║            CLASS IMBALANCE ISSUE - DIAGNOSIS & FIX             ║
╚════════════════════════════════════════════════════════════════╝

🔍 THE PROBLEM
━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━
Your dataset has severe class imbalance:

  Background pixels:  99.63%  █████████████████████████████
  Lesion pixels:       0.37%  ▏
  
  Ratio: 1:270 (270 background pixels per lesion pixel!)

🤔 WHY ACCURACY IS MISLEADING
━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━
The model can achieve 99.6% accuracy by predicting "no lesion"
everywhere - it's doing NOTHING useful!

  Ground Truth:     [0,0,0,1,0,0,0,0,0,0]  (10% lesions)
  Lazy Prediction:  [0,0,0,0,0,0,0,0,0,0]  (0% lesions)
  
  Accuracy: 90%! ✓ But it MISSED the lesion! ✗

✅ THE FIX - NOW IMPLEMENTED
━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━

1. ✅ Added Focal Loss
   - Down-weights easy examples (abundant background)
   - Focuses on hard examples (rare lesions)
   
2. ✅ Added Weighted Combined Loss
   - Focal Loss + Dice Loss
   - Now the DEFAULT in config.py
   
3. ✅ Better metrics to monitor
   - Focus on Dice, IoU, Sensitivity
   - Ignore misleading accuracy

📊 WHAT TO MONITOR NOW
━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━

❌ DON'T watch:
  - Pixel Accuracy (always ~99%, meaningless)

✅ DO watch:
  - Dice Coefficient  (target: > 0.6)
  - IoU               (target: > 0.5)
  - Sensitivity       (target: > 0.7)
  - Visual results    (predictions should show lesions!)

🚀 HOW TO USE
━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━

Config is already updated! Just train:

  python main.py --mode train --epochs 50

Then evaluate:

  python main.py --mode evaluate

📈 EXPECTED IMPROVEMENT
━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━

Old Loss (BCE + Dice):
  Dice: ~0.05          ✗ Model predicts mostly zeros
  Sensitivity: ~0.02   ✗ Misses 98% of lesions
  
New Loss (Focal + Dice):
  Dice: ~0.60-0.70     ✓ Good detection
  Sensitivity: ~0.70+  ✓ Finds most lesions
  IoU: ~0.50-0.60      ✓ Reasonable overlap

📚 DOCUMENTATION
━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━

See CLASS_IMBALANCE_GUIDE.md for detailed explanation and
advanced techniques.

✨ YOU'RE READY TO TRAIN WITH THE FIX!
━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━

  python main.py --mode train

Monitor Dice coefficient - it should improve from ~0 to >0.6!

